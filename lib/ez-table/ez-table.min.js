angular.module("ez.table",[]).constant("EzTableConfig",{limit:10,limits:[5,10,25,100],sortField:null,sortAscending:!1}).directive("ezTable",["$filter","EzTableConfig",function(a,b){return{restrict:"A",scope:!0,compile:function(c){var d,e,f,g="<thead><tr>",h='<tr ng-show="showFilters"><th></th>',i=c.find("tbody tr:first-child td");g+='<th><input class="batch-checkbox" type="checkbox" ng-model="isToggled" ng-change="toggleAll()"/></th>';for(var j=1;j<i.length-1;j++){if(d=angular.element(i[j]).data("title"),!d)throw new Error('data-title attribute must be specified for column "'+j+'"');e=d.charAt(0).toLowerCase()+d.slice(1),f=angular.element(i[j]).data("field")||e,g+="<th><a ng-click=\"sort('"+f+"')\">"+d+"<span ng-show=\"sortField == '"+e+'\'" ng-class="{\'caret-up\': !sortAscending}" class="caret"></span></a></th>',h+='<th><input class="form-control" ng-model="filters.'+f+'" type="text" ng-change="filter(\''+f+"')\"/></th>"}g+="<th></th></tr>",h+="<th></th></tr>",g+=h+"</thead>",c.prepend(g);var k='<tfoot><tr><td><input class="batch-checkbox" type="checkbox" ng-model="isToggled" ng-change="toggleAll()"/></td><td colspan="100%"><span class="pagination-container"><ul ng-show="pageCount > 1" class="pagination pagination-sm"><li ng-class="{disabled: currentPage == 0}"><a ng-click="prev()">&laquo;</a></li><li ng-class="{active: currentPage == $index}" ng-repeat="page in pages"><a ng-click="setPage($index)">{{ $index + 1 }}</a></li><li ng-class="{disabled: currentPage == (pageCount - 1)}"><a ng-click="next()">&raquo;</a></li></ul></span><span class="batch-actions" ng-show="showBatchActions"><a id="batchEdit" class="btn btn-sm btn-default" ng-click="batchEdit()" title="Batch Edit"><i class="icon-pencil"></i><span>Edit</span></a><a id="batchDelete" class="btn btn-sm btn-danger" ng-click="batchDelete()" title="Batch Delete"><i class="icon-remove"></i><span>Delete</span></a></span><span class="sort-container"><a class="filter-toggle btn btn-sm btn-default" ng-click="showFilters = !showFilters" title="Toggle Filters"><i class="icon-search"></i><span>Search</span></a><select class="form-control input-sm table-limit-select" ng-model="limit" ng-options="v for v in limits" title="Set Limit"></select></span></td></tfoot>';return c.append(k),c.addClass("table ez-table table-bordered"),function(c,d,e){c.limit=parseInt(e.limit,10)||b.limit,c.limits=c.$eval(e.limits)||b.limits,c.sortField=c.$eval(e.sortField)||b.sortField,c.sortAscending=c.$eval(e.sortAscending)||b.sortAscending,c.currentPage=0,c.batchAction="",c.filters={},c.setPage=function(a){c.currentPage=a,c.items=c.pages[a]},c.calcPages=function(b){var d=[];for(var f in c.filters)break;d=c.sortField?a("orderBy")(c.$eval(e.ezTable),c.sortField,!c.sortAscending):c.$eval(e.ezTable),f&&(d=a("filter")(d,c.filters)),c.pageCount=d.length/c.limit,c.pages=[];for(var g=0;g<c.pageCount;g++)c.pages[g]=d.slice(g*c.limit,g*c.limit+c.limit);c.setPage(b)},c.toggleAll=function(){angular.forEach(c.items,function(a,b){c.items[b]._selected=c.isToggled})},c.prev=function(){c.currentPage>0&&(c.items=c.pages[c.currentPage-1],c.currentPage--,c.isToggled=!1)},c.next=function(){c.currentPage!==c.pages.length-1&&(c.items=c.pages[c.currentPage+1],c.currentPage++,c.isToggled=!1)},c.sort=function(a){c.sortAscending=!c.sortAscending,c.sortField=a,c.calcPages(c.currentPage)},c.filter=function(){c.calcPages(0)},c.$watch("limit",function(a,b){a!==b&&c.calcPages(0)}),c.$watch(e.ezTable,function(a){c.showBatchActions=!1;var b=a.length;angular.forEach(a,function(a,d){return a._selected?(c.showBatchActions=!0,void 0):(d+1===b&&(c.isToggled=!1),void 0)}),c.calcPages(c.currentPage)},!0)}}}}]);